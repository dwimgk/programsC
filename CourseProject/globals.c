#include <stdbool.h>

#define GRID_ROWS 21
#define GRID_COLS 22
#define ALL_ROTATIONS 4
#define TETROMINO_ROWS 4
#define TETROMINO_COLS 8

// terminal top left corner is (1,1)
int pos_row;
int pos_col;
int current_shape[ALL_ROTATIONS][TETROMINO_ROWS][TETROMINO_COLS];
bool current_shape_isplaced;
bool key_pressed = false;
bool cannot_move_to_right;
bool cannot_move_to_left;
int rotation = 0;
// terminal top left corner is (1,1)
int start_pos_row = 0;
int start_pos_col = 9;
bool is_I;
bool is_O;


char* player;
int score = 0;

bool game_stop = false;


// playfield
int playfield[GRID_ROWS][GRID_COLS] = {
    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
    // 5
    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
    // 10
    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
    // 15
    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},

    {1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
    // 20
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}

};

int non_dynamic_playfield[GRID_ROWS][GRID_COLS];

// -\033- is called escape character -> ESC (ASCII 27). After it you write -[- called CSI -> controle sequence introducer,
// -31- is the color as seen above, -m- tells the terminal to apply the color
const char *color_white = "\033[37m";
// id 1
const char *color_red = "\033[31m";
// id 2
const char *color_green = "\033[32m";
// id 3
const char *color_yellow = "\033[33m";
// id 4
const char *color_purple = "\033[35m";
// id 5
const char *color_cyan = "\033[36m";
// id 6
const char *color_orange = "\033[38;5;214m"; // Extended color for orange
//id 7
const char *color_pink = "\033[38;5;213m";   // Extended color for pink
//id 8
const char *color_off = "\033[0m"; // Reset to default


const int shapes_S[4][TETROMINO_ROWS][TETROMINO_COLS] = {
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 2, 2, 2, 2, 0, 0},

        {2, 2, 2, 2, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {2, 2, 0, 0, 0, 0, 0, 0},

        {2, 2, 2, 2, 0, 0, 0, 0},

        {0, 0, 2, 2, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 2, 2, 2, 2, 0, 0},

        {2, 2, 2, 2, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {2, 2, 0, 0, 0, 0, 0, 0},

        {2, 2, 2, 2, 0, 0, 0, 0},

        {0, 0, 2, 2, 0, 0, 0, 0}
    }
};
const int shapes_O[4][TETROMINO_ROWS][TETROMINO_COLS] = {
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {4, 4, 4, 4, 0, 0, 0, 0},

        {4, 4, 4, 4, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {4, 4, 4, 4, 0, 0, 0, 0},

        {4, 4, 4, 4, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {4, 4, 4, 4, 0, 0, 0, 0},

        {4, 4, 4, 4, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {4, 4, 4, 4, 0, 0, 0, 0},

        {4, 4, 4, 4, 0, 0, 0, 0}
    }
};
const int shapes_Z[4][TETROMINO_ROWS][TETROMINO_COLS] = {
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {3, 3, 3, 3, 0, 0, 0, 0},

        {0, 0, 3, 3, 3, 3, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 3, 3, 0, 0, 0, 0},

        {3, 3, 3, 3, 0, 0, 0, 0},

        {3, 3, 0, 0, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {3, 3, 3, 3, 0, 0, 0, 0},

        {0, 0, 3, 3, 3, 3, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 3, 3, 0, 0, 0, 0},

        {3, 3, 3, 3, 0, 0, 0, 0},

        {3, 3, 0, 0, 0, 0, 0, 0}
    }
};
const int shapes_I[4][TETROMINO_ROWS][TETROMINO_COLS] = {
    {
        {6, 6, 0, 0, 0, 0, 0, 0},

        {6, 6, 0, 0, 0, 0, 0, 0},

        {6, 6, 0, 0, 0, 0, 0, 0},

        {6, 6, 0, 0, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {6, 6, 6, 6, 6, 6, 6, 6}
    },
    {
        {6, 6, 0, 0, 0, 0, 0, 0},

        {6, 6, 0, 0, 0, 0, 0, 0},

        {6, 6, 0, 0, 0, 0, 0, 0},

        {6, 6, 0, 0, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {6, 6, 6, 6, 6, 6, 6, 6}
    }
};
const int shapes_L[4][TETROMINO_ROWS][TETROMINO_COLS] = {
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {7, 7, 0, 0, 0, 0, 0, 0},

        {7, 7, 0, 0, 0, 0, 0, 0},

        {7, 7, 7, 7, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 7, 7, 0, 0},

        {7, 7, 7, 7, 7, 7, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {7, 7, 7, 7, 0, 0, 0, 0},

        {0, 0, 7, 7, 0, 0, 0, 0},

        {0, 0, 7, 7, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {7, 7, 7, 7, 7, 7, 0, 0},

        {7, 7, 0, 0, 0, 0, 0, 0}
    }
};
const int shapes_J[4][TETROMINO_ROWS][TETROMINO_COLS] = {
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 8, 8, 0, 0, 0, 0},

        {0, 0, 8, 8, 0, 0, 0, 0},

        {8, 8, 8, 8, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {8, 8, 8, 8, 8, 8, 0, 0},

        {0, 0, 0, 0, 8, 8, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {8, 8, 8, 8, 0, 0, 0, 0},

        {8, 8, 0, 0, 0, 0, 0, 0},

        {8, 8, 0, 0, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {8, 8, 0, 0, 0, 0, 0, 0},

        {8, 8, 8, 8, 8, 8, 0, 0}
    }
};
const int shapes_T[4][TETROMINO_ROWS][TETROMINO_COLS] = {
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {5, 5, 5, 5, 5, 5, 0, 0},

        {0, 0, 5, 5, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {5, 5, 0, 0, 0, 0, 0, 0},

        {5, 5, 5, 5, 0, 0, 0, 0},

        {5, 5, 0, 0, 0, 0, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 5, 5, 0, 0, 0, 0},

        {5, 5, 5, 5, 5, 5, 0, 0}
    },
    {
        {0, 0, 0, 0, 0, 0, 0, 0},

        {0, 0, 5, 5, 0, 0, 0, 0},

        {5, 5, 5, 5, 0, 0, 0, 0},

        {0, 0, 5, 5, 0, 0, 0, 0}
    }
};